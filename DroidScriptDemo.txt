// Hello World Script
var Toast = Packages.android.widget.Toast;
Toast.makeText(
    Activity,
    "Hello World!",
    Toast.LENGTH_SHORT).show();
   
// Button Script
var button = new Packages.android.widget.Button(Activity);
button.setText("Hello World!");
button.setOnClickListener(function () {
    button.setText("You Clicked Me!"); })
Activity.setContentView(button);

// Button Activity
function onCreate(icicle)
{
    var Button = Packages.android.widget.Button;
    var Typeface = Packages.android.graphics.Typeface;
    var Color = Packages.android.graphics.Color;
    
    var font = Typeface.create(
        Typeface.SANS_SERIF,
        Typeface.BOLD);
    var button = new Button(Activity);
    button.setText("Hello World!");
    button.setTypeface(font);
    button.setTextSize(26);
    button.setBackgroundColor(Color.rgb(0, 0, 64));
    button.setTextColor(Color.rgb(255, 255, 255));
    button.setOnClickListener(function () {
        button.setText("You Clicked Me!"); })
    Activity.setContentView(button);
}

// Buttons Script
function createButton() {
    var n = 1;
    var Graphics = Packages.android.graphics;
    var font = Graphics.Typeface.create(
        Graphics.Typeface.SANS_SERIF,
        Graphics.Typeface.BOLD);
    var button = new Packages.android.widget.Button(Activity);
    button.setTypeface(font);
    button.setTextSize(26);
    button.setBackgroundColor(Graphics.Color.rgb(0, 0, 64));
    button.setTextColor(Graphics.Color.rgb(255, 255, 255));
    button.setText("How many times can you click me?");
    button.setOnClickListener(function () {
        button.setText("You clicked me " + n + " times!");
        n = n + 1;
    });
    return button;
}

var layout = new Packages.android.widget.LinearLayout(Activity);
layout.setOrientation(Widget.LinearLayout.VERTICAL);
layout.addView(createButton());
layout.addView(createButton());
layout.addView(createButton());
Activity.setContentView(layout);


// Camera Activity
var Camera = Packages.android.hardware.Camera;
var SurfaceHolder = Packages.android.view.SurfaceHolder;
var SurfaceView = Packages.android.view.SurfaceView;
var Window = Packages.android.view.Window;

function onCreate(bundle)
{
    Activity.requestWindowFeature(Window.FEATURE_NO_TITLE);
    var preview = createPreviewSurface();
    Activity.setContentView(preview.getSurfaceView());
}

function createPreviewSurface()
{
    var camera = null;
    var surface = new SurfaceView(Activity);
    
    var object = {
        
        getSurfaceView : function() {
            return surface; },
            
        surfaceCreated : function(holder) {
            camera = Camera.open();
            try {
                camera.setPreviewDisplay(holder); }
            catch (exception) {
                camera.release();
                camera = null; } },
                
        surfaceDestroyed : function(holder) {
            camera.stopPreview();
            camera.release();
            camera = null; },
            
        surfaceChanged : function(holder, format, w, h) {
            //var parameters = camera.getParameters();
            //parameters.setPreviewSize(w, h);
            //camera.setParameters(parameters);
            camera.startPreview(); }
    };
 
    var callback = createInstance(
        Packages.android.view.SurfaceHolder.Callback, 
        object);
    surface.getHolder().addCallback(callback);
    surface.getHolder().setType(
        SurfaceHolder.SURFACE_TYPE_PUSH_BUFFERS);

    return object;
}

function createInstance(javaInterface, object)
{
    function javaArrayToJsArray(javaArray)
    {
        var jsArray = [];
        for (var i = 0; i < javaArray.length; ++i) {
            jsArray[i] = javaArray[i];
        }
        return jsArray;
    }
    
    var lang = Packages.java.lang;
    var interfaces = 
        lang.reflect.Array.newInstance(lang.Class, 1);
    interfaces[0] = javaInterface;
    var obj = lang.reflect.Proxy.newProxyInstance(
        lang.ClassLoader.getSystemClassLoader(),
        interfaces,
        function(proxy, method, args) {
            return object[method.getName()].apply(
                null,
                javaArrayToJsArray(args));
        });
    return obj;
}


// WebKit Activity
function onCreate(bubble)
{
    var WebView = Packages.android.webkit.WebView;

    var webview = new WebView(Activity);
    webview.getSettings().setJavaScriptEnabled(true);
    webview.addJavascriptInterface(Activity, "activity");
    Activity.setContentView(webview);    
    
    var content =
    """<html>
        <body>
            <script>
            function showToast(message) {
                activity.eval(
                    "var Toast = Packages.android.widget.Toast;" +
                    "Toast.makeText(Activity, '" + message + "', " +
                    "Toast.LENGTH_SHORT).show();"); }
            </script>
            <h1>Take the pill</h1>
            <input 
                type="button" 
                value="Take pill" 
                onclick="showToast('You have taken the red pill!')">
        </body>
    </html>""";
    
    webview.loadData(content, "text/html", "utf-8");
}

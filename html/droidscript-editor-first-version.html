<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>DroidScript - Live JavaScript on Android</title>
<link rel="stylesheet" type="text/css" href="styles.css" />
<script src="jquery-1.3.2.min.js" type="text/javascript"></script>
<script src="CodeMirror/js/codemirror.js" type="text/javascript"></script>                                                                   
<script type="text/javascript">                                         
$(document).ready(function() 
{
    var editor = CodeMirror.fromTextArea("code", 
    {
        parserfile: ["tokenizejavascript.js", "parsejavascript.js"],
        path: "CodeMirror/js/",
        stylesheet: "CodeMirror/css/jscolors.css",
        height: "100%",
        width: "100%",
        indentUnit: 4,
        autoMatchParens: true
        // lineNumbers: true
    });
    
    var result = CodeMirror.fromTextArea("result",
    {
        parserfile: ["tokenizejavascript.js", "parsejavascript.js"],
        path: "CodeMirror/js/",
        stylesheet: "CodeMirror/css/jscolors.css",
        height: "100%",
        width: "100%"
    });    

    $("input.buttonRun").click(function() 
    {
        var code = editor.selection(); //.getCode();
        var ipaddress = getDeviceIpAddress();
        var res = sendToDevice("eval", code, ipaddress);
        showResult(res);
    });

    $("input.buttonRunActivity").click(function() 
    {
        var code = editor.selection(); //.getCode();
        var ipaddress = getDeviceIpAddress();
        var res = sendToDevice("run", code, ipaddress);
        showResult(res);
    });

    $("input.buttonIndentSelection").click(function() 
    {
        editor.reindentSelection(); 
    });
    
    $("input.buttonUndo").click(function() 
    {
        editor.undo(); 
    });

    $("input.buttonRedo").click(function() 
    {
        editor.redo(); 
    });
    
    $("input.buttonClearResult").click(function() 
    {
        result.setCode(""); 
    });

    $("input.buttonEvalInBrowser").click(function() 
    {
        try {
            var code = editor.selection();
            var res = eval(code);
            showResult(res); }
        catch (error) {
             showResult("{*.*} " + error); }
    });
    
    function getDeviceIpAddress()
    {
        return jQuery.trim($("input.ipaddress").val());
    }
    
    function showResult(res)
    {
        result.setCode(res + "\n" + result.getCode()); 
    }

    function sendToDevice(action, code, ipaddress) 
    {
        var result = "[*_*] Cannot communicate with the device!";
        try
        {
            var deviceUrl = "http://" + ipaddress + ":4042/" + action + "/";
            var response = $.ajax(
            {
                url: deviceUrl,
                type: "PUT",
                data: code,
                processData: false,
                dataType: "text/plain",
                async: false,
                timeout: 5000,
                success: function(data)
                {
                    result = data;
                },
                error: function(req, status, err)
                {
                    result = "['_'] " + status;
                }
             });
        }
        catch (error)
        {
            result = "[*_*] " + error;
        }
        return result;
    }
});
</script> 
</head>

<body>

<div class="text" id="header">
<img src="DroidScript.png" width="300px" height="50px"/> Live JavaScript on Android (^_^)
</div>

<script type="text/javascript">
</script>

<div class="border" id="ipaddress">
Device ip-address: 
<input class="ipaddress" value="192.168.0.100" type="text" />
</div>

<div class="border" id="codearea">
<textarea id="code">
// **************************************************
// * Welcome to the Wonderful World of DroidScript! *
// **************************************************
//
// DroidScript is a programming tool for Android. The text in this
// window is a JavaScript program that can run on your device.
//
// How To: 
// 1) Make sure you are using a web browser that supports XMLHttpRequest
//    Level 2. Firefox 3.5 or later is recommended. Other browsers will not work.
// 2) Install the app DroidScript.apk on your Android device, by scanning the
//    barcode at the bottom of this page with the Barcode Scanner app by ZXing.
// 3) Make sure that both the computer you are using to view this page and
//    the device are connected to the same wireless network.
// 4) Start the DroidScript app on the device. Press menu button, select "Start server".
// 5) Enter the ip-address shown on the start screen in the text box above.
// 6) Select code you want to run and click the Run button to on the device.
// 7) Have fun!

// Toast example program. Select this code and click Run.
var Toast = Packages.android.widget.Toast;
Toast.makeText(
    Activity,
    "Hello World!", 
    Toast.LENGTH_SHORT).show();
    
// Select this code and click Run. It will create a button in
// the server activity.
var button = new Packages.android.widget.Button(Activity);
button.setText("Hello World!");
button.setOnClickListener(function () { 
    button.setText("You Clicked Me!"); })
Activity.setContentView(button);

// You can also run code as a new Activity. Select this code
// and click "Run as Activity". A new DroidScript activity will 
// be created, and the onCreate function is called.
function onCreate(icicle)
{
    var widget = Packages.android.widget;
    var graphics = Packages.android.graphics;
    var font = graphics.Typeface.create(
        graphics.Typeface.SANS_SERIF, 
        graphics.Typeface.BOLD);
    var button = new widget.Button(Activity);
    button.setText("Hello World!");
    button.setTypeface(font);
    button.setTextSize(26);
    button.setBackgroundColor(graphics.Color.rgb(0, 0, 64));
    button.setTextColor(graphics.Color.rgb(255, 255, 255));
    button.setOnClickListener(function () { 
        button.setText("You Clicked Me!"); })
    Activity.setContentView(button);
}

// Also try evaluating these expressions, select and run one line at a time.
// Watch the result in the result area.
1 + 3
22 * 99 - 7
function twice(n) { return n * 2; }
twice(22)
</textarea>
</div>

<div id="buttonbar">
<input value="Run selection" class="buttonRun" type="button" />
<input value="Run as Activity" class="buttonRunActivity" type="button" />
<input value="Indent selection" class="buttonIndentSelection" type="button" />
<input value="Undo" class="buttonUndo" type="button" />
<input value="Redo" class="buttonRedo" type="button" />
<input value="Clear result area" class="buttonClearResult" type="button" />
<!-- <input value="Eval in browser" class="buttonEvalInBrowser" type="button" /> -->
</div>

<div class="border" id="resultarea">
<textarea id="result" >
Result area.
</textarea>
</div>

<div class="text" id="contact">
Copyright (c) 2010 Mikael Kindborg 
| Source code license: MIT 
| Contact: 
<a href="http://twitter.com/divineprog" target="_blank">Twitter</a>
<a href="http://droidscript.blogspot.com" target="_blank">Blog</a>
</div>

<div class="text" id="download">
Scan QR-code to install the DroidScript app or download from url:
<a href="http://droidscript.se/DroidScript.apk">http://droidscript.se/DroidScript.apk</a>
</div>

<div>
<img src="http://qrcode.kaywa.com/img.php?s=5&d=http%3A%2F%2Fdroidscript.se%2FDroidScript.apk" alt="qrcode" />
</div>

</body>
</html>
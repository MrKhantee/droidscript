<html>
<head>
<title>DroidScript - Live JavaScript on Android</title>
<link rel="stylesheet" type="text/css" href="dsedit.css" />
<script src="jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="jquery-ui-1.8.custom.min.js" type="text/javascript"></script>
<script src="jquery.layout-latest.js"  type="text/javascript"></script>
<script src="CodeMirror/js/codemirror.js" type="text/javascript"></script>
<script>
$(document).ready(function() 
{
    var editor = CodeMirror.fromTextArea("codeeditor", 
    {
        parserfile: ["tokenizejavascript.js", "parsejavascript.js"],
        path: "CodeMirror/js/",
        stylesheet: "CodeMirror/css/jscolors.css",
        height: "100%",
        width: "100%",
        indentUnit: 4,
        autoMatchParens: true
        // lineNumbers: true
    });
    
    var result = CodeMirror.fromTextArea("resulteditor",
    {
        parserfile: ["tokenizejavascript.js", "parsejavascript.js"],
        path: "CodeMirror/js/",
        stylesheet: "CodeMirror/css/jscolors.css",
        height: "100%",
        width: "100%"
    });    

    $("input.buttonRun").click(function() 
    {
        var code = editor.selection(); //.getCode();
        var ipaddress = getDeviceIpAddress();
        var res = sendToDevice("eval", code, ipaddress);
        showResult(res);
    });

    $("input.buttonRunActivity").click(function() 
    {
        var code = editor.selection(); //.getCode();
        var ipaddress = getDeviceIpAddress();
        var res = sendToDevice("run", code, ipaddress);
        showResult(res);
    });

    $("input.buttonIndentSelection").click(function() 
    {
        editor.reindentSelection(); 
    });
    
    $("input.buttonUndo").click(function() 
    {
        editor.undo(); 
    });

    $("input.buttonRedo").click(function() 
    {
        editor.redo(); 
    });
    
    $("input.buttonClearResult").click(function() 
    {
        result.setCode(""); 
    });

    $("input.buttonEvalInBrowser").click(function() 
    {
        try {
            var code = editor.selection();
            var res = eval(code);
            showResult(res); }
        catch (error) {
             showResult("{*.*} " + error); }
    });
    
    function getDeviceIpAddress()
    {
        return jQuery.trim($("input.ipaddress").val());
    }
    
    function showResult(res)
    {
        result.setCode(res + "\n" + result.getCode()); 
    }

    function sendToDevice(action, code, ipaddress) 
    {
        var result = "[*_*] Cannot communicate with the device!";
        try
        {
            var deviceUrl = "http://" + ipaddress + ":4042/" + action + "/";
            var response = $.ajax(
            {
                url: deviceUrl,
                type: "PUT",
                data: code,
                processData: false,
                dataType: "text/plain",
                async: false,
                timeout: 5000,
                success: function(data)
                {
                    result = data;
                },
                error: function(req, status, err)
                {
                    result = "['_'] " + status;
                }
             });
        }
        catch (error)
        {
            result = "[*_*] " + error;
        }
        return result;
    }

    //$("body").layout({ applyDefaultStyles: true });
    $("body").layout();
    
});
</script>
</head>
<body>

<div class="ui-layout-center">
<div id="codearea">
<textarea id="codeeditor">
// **************************************************
// * Welcome to the Wonderful World of DroidScript! *
// **************************************************
// 
// DroidScript is a programming tool for Android. The text in this
// window is JavaScript code that can run on your device.
//
// Kindly use Firefox 3.5 or later with this page.
// 
// Click the link "Help & Download" below to download the DroidScript app.
//
// How To: 
// 1) Make sure you are using a web browser that supports XMLHttpRequest
//    Level 2. Firefox 3.5 or later is recommended. Other browsers will not work.
// 2) Install the app http://droidscript.se/DroidScript.apk on your Android device.
// 3) Make sure that both your computer and the device are connected to the 
//    same wireless network, and that wifi networking is enabled on the device.
// 4) Start DroidScript on the device. Press menu button, select "Start server".
// 5) Enter the ip-address shown on the start screen in the text box above.
// 6) Select code you want to run and click the Run button.
// 7) Have fun!

// Toast example program. Select this code and click Run.
var Toast = Packages.android.widget.Toast;
Toast.makeText(
    Activity,
    "Hello World!", 
    Toast.LENGTH_SHORT).show();
    
// Select this code and click Run. It will create a button in
// the server activity.
var button = new Packages.android.widget.Button(Activity);
button.setText("Hello World!");
button.setOnClickListener(function () { 
    button.setText("You Clicked Me!"); })
Activity.setContentView(button);

// You can also run code as a new Activity. Select this code
// and click "Run as Activity". A new DroidScript activity will 
// be created, and the onCreate function is called.
function onCreate(icicle)
{
    var Button = Packages.android.widget.Button;
    var Typeface = Packages.android.graphics.Typeface;
    var Color = Packages.android.graphics.Color;
    
    var font = Typeface.create(
        Typeface.SANS_SERIF, 
        Typeface.BOLD);
    var button = new Button(Activity);
    button.setText("Hello World!");
    button.setTypeface(font);
    button.setTextSize(26);
    button.setBackgroundColor(Color.rgb(0, 0, 64));
    button.setTextColor(Color.rgb(255, 255, 255));
    button.setOnClickListener(function () { 
        button.setText("You Clicked Me!"); })
    Activity.setContentView(button);
}

// Also try evaluating these expressions, select and run one line at a time.
// Watch the result in the result area.
1 + 3
22 * 99 - 7
function twice(n) { return n * 2; }
twice(22)
</textarea>
</div>
</div>

<div class="ui-layout-south">
<div id="toolbar">
<input value="Run selection" class="buttonRun" type="button" />
<input value="Run as Activity" class="buttonRunActivity" type="button" />
<input value="Indent selection" class="buttonIndentSelection" type="button" />
<input value="Undo" class="buttonUndo" type="button" />
<input value="Redo" class="buttonRedo" type="button" />
<input value="Clear result area" class="buttonClearResult" type="button" />
<!-- <input value="Eval in browser" class="buttonEvalInBrowser" type="button" /> -->
Device&nbsp;ip-address: 
<input class="ipaddress" value="192.168.0.100" type="text" />
<a href="index.html" target="_blank">New&nbsp;Editor</a>
<a href="http://droidscript.blogspot.com/2010/03/droidscript-getting-started.html" target="_blank">Help&nbsp;&amp;&nbsp;Download</a>
</div>
<div id="resultarea">
<textarea id="resulteditor" >
</textarea>
</div>

</div>
</body>
</html>
